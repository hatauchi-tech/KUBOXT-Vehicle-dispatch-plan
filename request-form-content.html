<!-- 依頼入力/編集画面 (SCR-01) - コンテンツ部分のみ -->
<div class="page-header">
  <h1 class="page-title" id="pageTitle">
    <i class="material-icons large" style="vertical-align: middle;">add_circle</i>
    依頼登録
  </h1>
  <p class="page-subtitle" id="pageSubtitle">新規配送依頼を登録します</p>
</div>

<div class="card">
  <div class="card-content">
    <form id="requestForm" class="request-form">

      <!-- 編集モード用の隠しフィールド -->
      <input type="hidden" id="requestId" name="requestId">

      <!-- 基本情報セクション -->
      <div class="form-section">
        <h5 class="section-title">
          <i class="material-icons">info</i>
          基本情報
        </h5>

        <div class="row">
          <div class="input-field col s12 m6">
            <input type="date" id="receivedDate" name="receivedDate" required>
            <label for="receivedDate" class="active">受付日 <span class="red-text">*</span></label>
          </div>

          <div class="input-field col s12 m6">
            <select id="shipper" name="shipper" required>
              <option value="" disabled selected>選択してください</option>
            </select>
            <label>荷主 <span class="red-text">*</span></label>
          </div>
        </div>

        <!-- 荷主のお気に入り入力ボックス -->
        <div class="row" id="shipperFavoritesBox" style="display: none;">
          <div class="col s12">
            <div class="card-panel blue lighten-5" style="padding: 15px; margin-top: 0;">
              <h6 style="font-size: 1.1rem; color: #1976D2; margin-top: 0; margin-bottom: 10px;">
                <i class="material-icons left" style="font-size: 1.3rem;">history</i>
                よく使う設定
              </h6>
              <div id="shipperFavoritesContent">
                <p class="text-secondary" style="margin: 0;">荷主を選択すると、よく使う設定がここに表示されます。</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- 日程セクション -->
      <div class="form-section">
        <h5 class="section-title">
          <i class="material-icons">event</i>
          日程
        </h5>

        <div class="row">
          <div class="input-field col s12 m6">
            <input type="date" id="loadDate" name="loadDate" class="datepicker" required>
            <label for="loadDate" class="active">積込日 <span class="red-text">*</span></label>
          </div>

          <div class="input-field col s12 m6">
            <input type="time" id="loadTime" name="loadTime" class="timepicker">
            <label for="loadTime" class="active">積込時間</label>
            <span class="helper-text">未定の場合は空欄でOK</span>
          </div>
        </div>

        <div class="row">
          <div class="input-field col s12 m6">
            <input type="date" id="unloadDate" name="unloadDate" class="datepicker" required>
            <label for="unloadDate" class="active">荷卸日 <span class="red-text">*</span></label>
          </div>

          <div class="input-field col s12 m6">
            <input type="time" id="unloadTime" name="unloadTime" class="timepicker">
            <label for="unloadTime" class="active">荷卸時間</label>
            <span class="helper-text">未定の場合は空欄でOK</span>
          </div>
        </div>
      </div>

      <!-- 積込場所セクション -->
      <div class="form-section">
        <h5 class="section-title">
          <i class="material-icons">arrow_upward</i>
          積込場所
        </h5>

        <div class="row">
          <div class="input-field col s12">
            <input type="text" id="loadPlace1" name="loadPlace1" required>
            <label for="loadPlace1">積込地1 <span class="red-text">*</span></label>
            <span class="helper-text">例: 〇〇県〇〇市〇〇町1-2-3</span>
          </div>
        </div>

        <div class="row">
          <div class="input-field col s12">
            <input type="text" id="loadPlace2" name="loadPlace2">
            <label for="loadPlace2">積込地2</label>
            <span class="helper-text">2箇所目の積込地がある場合に入力してください</span>
          </div>
        </div>
      </div>

      <!-- 荷卸場所セクション -->
      <div class="form-section">
        <h5 class="section-title">
          <i class="material-icons">arrow_downward</i>
          荷卸場所
        </h5>

        <div class="row">
          <div class="input-field col s12">
            <input type="text" id="unloadPlace1" name="unloadPlace1" required>
            <label for="unloadPlace1">荷卸地1 <span class="red-text">*</span></label>
            <span class="helper-text">例: 〇〇県〇〇市〇〇町1-2-3</span>
          </div>
        </div>

        <div class="row">
          <div class="input-field col s12">
            <input type="text" id="unloadPlace2" name="unloadPlace2">
            <label for="unloadPlace2">荷卸地2</label>
            <span class="helper-text">2箇所目の荷卸地がある場合に入力してください</span>
          </div>
        </div>
      </div>

      <!-- ★★★ NEW: 明細入力セクション ★★★ -->
      <div class="form-section">
        <h5 class="section-title">
          <i class="material-icons">list</i>
          明細登録
          <span style="font-size: 0.9rem; color: #666; font-weight: normal; margin-left: 10px;">
            (複数の車両・品名を一括登録できます)
          </span>
        </h5>

        <!-- 明細入力フォーム -->
        <div class="card blue-grey lighten-5" style="padding: 20px; margin-bottom: 20px;">
          <div class="row" style="margin-bottom: 10px;">
            <div class="input-field col s12 m6">
              <select id="detailRequestType">
                <option value="" disabled selected>選択してください</option>
              </select>
              <label>依頼車種 <span class="red-text">*</span></label>
            </div>

            <div class="input-field col s12 m6">
              <input type="text" id="detailProductName">
              <label for="detailProductName">品名 <span class="red-text">*</span></label>
            </div>
          </div>

          <div class="row" style="margin-bottom: 0;">
            <div class="col s12 center-align">
              <button type="button" id="addDetailBtn" class="btn waves-effect waves-light green">
                <i class="material-icons left">add</i>
                明細を追加
              </button>
            </div>
          </div>
        </div>

        <!-- 明細一覧テーブル -->
        <div id="detailListContainer">
          <table class="striped highlight responsive-table" id="detailTable" style="display: none;">
            <thead>
              <tr>
                <th style="width: 60px;">No.</th>
                <th>依頼車種</th>
                <th>品名</th>
                <th style="width: 100px; text-align: center;">操作</th>
              </tr>
            </thead>
            <tbody id="detailTableBody">
              <!-- 明細行がJavaScriptで追加されます -->
            </tbody>
          </table>
          <div id="noDetailMessage" class="center-align" style="padding: 20px; color: #666;">
            <i class="material-icons" style="font-size: 48px; color: #bbb;">inbox</i>
            <p>明細が登録されていません。上記のフォームから明細を追加してください。</p>
          </div>
        </div>

        <div class="row" style="margin-top: 20px;">
          <div class="col s12">
            <p class="helper-text" style="margin: 0;">
              <i class="material-icons tiny">info</i>
              <strong>登録件数: <span id="detailCount" class="blue-text">0</span> 件</strong>
              <br>
              同じ現場に複数台の車両が必要な場合、明細を複数追加してから一括登録してください。
            </p>
          </div>
        </div>
      </div>
      <!-- ★★★ 明細入力セクション ここまで ★★★ -->

      <!-- フォームアクション -->
      <div class="form-actions">
        <button type="button" id="cancelBtn" class="btn btn-large waves-effect waves-light grey">
          <i class="material-icons left">clear</i>
          <span id="cancelBtnText">クリア</span>
        </button>
        <button type="submit" id="submitBtn" class="btn btn-large waves-effect waves-light blue darken-1">
          <i class="material-icons left">save</i>
          <span id="submitBtnText">一括登録</span>
        </button>
      </div>

    </form>
  </div>
</div>

<!-- 注意事項 -->
<div class="card blue lighten-5">
  <div class="card-content">
    <span class="card-title">
      <i class="material-icons left">info_outline</i>
      入力時の注意事項
    </span>
    <ul class="browser-default">
      <li><span class="red-text">*</span>印の項目は必須入力です</li>
      <li>荷卸日は、積込日以降の日付を入力してください</li>
      <li>時間が未定の場合は、時間の入力を空欄のままにしてください（午前中・午後など大まかな指定で構いません）</li>
      <li><strong>明細登録について:</strong> 同じ現場に複数台（10台、15台等）が必要な場合、明細を複数追加してから「一括登録」ボタンを押してください</li>
      <li>一括登録すると、明細の数だけ依頼IDが連番で自動生成されます（例: REQ20251117-0001, REQ20251117-0002...）</li>
    </ul>
  </div>
</div>
